<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="수비학 운세 사주번호 계산기 - 나와 잘 맞는 장소, 번호, 지형 찾기">
    <title>사주번호 운세 계산기</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>사주번호 운세 계산기</h1>
            <p class="subtitle">나와 잘 맞는 장소와 번호를 찾아보세요</p>
        </header>

        <main>
            <!-- 입력 폼 -->
            <section class="input-section glass-card">
                <div class="intro-box">
                    <h3>🔮 운세 계산 방법</h3>
                    <ul>
                        <li><strong>사주번호</strong>: 생년월일 기반 평생 운명수 (비중 <span class="badge">80%</span>)</li>
                        <li><strong>이름 번호</strong>: 각 글자의 운명수 (비중 <span class="badge">20%</span>)</li>
                        <li><strong>해운번호</strong>: 매년 변하는 올해 운세 번호</li>
                    </ul>
                </div>

                <form id="calc-form">
                    <div class="form-group">
                        <label for="name">이름</label>
                        <input type="text" id="name" placeholder="이름을 입력하세요 (선택)">
                    </div>

                    <div class="form-group">
                        <label for="solarYmd">생년월일 (양력)</label>
                        <input type="text" id="solarYmd" placeholder="예: 19900101" maxlength="8" inputmode="numeric">
                        <small>8자리 숫자 (YYYYMMDD)</small>
                    </div>

                    <div class="form-group">
                        <label for="lunarYmd">생년월일 (음력)</label>
                        <input type="text" id="lunarYmd" placeholder="예: 19900101" maxlength="8" inputmode="numeric">
                        <small>8자리 숫자 (YYYYMMDD)</small>
                    </div>

                    <div class="form-group">
                        <label for="refYear">기준연도</label>
                        <input type="number" id="refYear" value="2025" min="2000" max="2099">
                        <small>해운번호 계산 기준</small>
                    </div>

                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="privacyAgree" required>
                            <span>개인정보 수집 및 이용에 동의합니다</span>
                        </label>
                        <small class="privacy-text">입력하신 정보는 운세 계산에만 사용되며 저장되지 않습니다.</small>
                    </div>

                    <button type="submit" class="btn-primary">운세 보기</button>
                </form>
            </section>

            <!-- 빈 상태 -->
            <section id="emptyState" class="empty-state glass-card">
                <div class="empty-icon">🔮</div>
                <p>생년월일을 입력하고<br>나만의 운세를 확인해보세요</p>
            </section>

            <!-- 결과 화면 -->
            <section id="results" class="results hidden">

                <!-- AI 리포트 버튼 (결과 상단에 배치) -->
                <div class="glass-card" style="text-align: center; padding: 20px;">
                    <h3>🤖 AI 심층 분석</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">당신의 사주와 지식을 결합한 상세 보고서를 받아보세요.</p>
                    <button id="btnAiReport" class="btn-ai-report">상세 운세 보고서 생성 (AI)</button>
                </div>

                <!-- 이름 사주 값 -->
                <div id="nameSection" class="result-card glass-card hidden">
                    <h2>이름 사주번호</h2>
                    <div class="info-box">
                        <div class="info-icon">📝</div>
                        <div class="info-content">
                            <strong>이름의 운명수</strong>
                            <p>각 글자에 맞는 운명수로 평생 변하지 않는 번호입니다. 전체 운세의 <strong>20%</strong>를 차지하며, 이름이 가진 에너지와 특성을 나타냅니다.
                            </p>
                        </div>
                    </div>
                    <div id="nameSajuValues" class="pill-container"></div>
                    <div id="nameMeaningList" class="meaning-list"></div>
                </div>

                <!-- 양력 사주 -->
                <div id="solarSajuSection" class="result-card glass-card hidden">
                    <h2>사주번호 (양력)</h2>
                    <div class="info-box">
                        <div class="info-icon">⭐</div>
                        <div class="info-content">
                            <strong>나의 운명수</strong>
                            <p>생년월일로 계산되는 평생 변하지 않는 운명 번호입니다. 전체 운세의 <strong>80%</strong>를 차지하며, 당신의 본질적인 성향과 인생의 방향을
                                나타냅니다.</p>
                        </div>
                    </div>
                    <div class="number-display">
                        <span id="sajuFirstSolar" class="big-number">-</span>
                        <span class="plus">+</span>
                        <span id="sajuSecondSolar" class="big-number">-</span>
                    </div>
                    <p id="sajuDescSolar" class="desc"></p>
                    <div class="meaning-box">
                        <p id="sajuMeaningSolar" class="meaning"></p>
                        <p id="sajuMeaningSolar2" class="meaning"></p>
                    </div>
                </div>

                <!-- 음력 사주 -->
                <div id="lunarSajuSection" class="result-card glass-card hidden">
                    <h2>사주번호 (음력)</h2>
                    <div class="info-box">
                        <div class="info-icon">⭐</div>
                        <div class="info-content">
                            <strong>나의 운명수</strong>
                            <p>생년월일로 계산되는 평생 변하지 않는 운명 번호입니다. 전체 운세의 <strong>80%</strong>를 차지하며, 당신의 본질적인 성향과 인생의 방향을
                                나타냅니다.</p>
                        </div>
                    </div>
                    <div class="number-display">
                        <span id="sajuFirstLunar" class="big-number">-</span>
                        <span class="plus">+</span>
                        <span id="sajuSecondLunar" class="big-number">-</span>
                    </div>
                    <p id="sajuDescLunar" class="desc"></p>
                    <div class="meaning-box">
                        <p id="sajuMeaningLunar" class="meaning"></p>
                        <p id="sajuMeaningLunar2" class="meaning"></p>
                    </div>
                </div>

                <!-- 양력 해운 -->
                <div id="solarHaeunSection" class="result-card glass-card hidden">
                    <h2>해운번호 (양력)</h2>
                    <div class="info-box info-box-yearly">
                        <div class="info-icon">🔮</div>
                        <div class="info-content">
                            <strong>올해의 운세 번호</strong>
                            <p>매년 운세를 나타내는 번호로 <strong>매년 변합니다</strong>. 각 번호 조합마다 점수와 해석이 다르며, 올해 당신이 겪을 상황과 주의사항을
                                알려줍니다.</p>
                        </div>
                    </div>
                    <div class="number-display">
                        <span id="haeunFirstSolar" class="big-number">-</span>
                        <span class="plus">/</span>
                        <span id="haeunSecondSolar" class="big-number">-</span>
                    </div>
                    <p id="haeunDescSolar" class="desc"></p>
                    <div class="meaning-box">
                        <p id="haeunMeaningSolar" class="meaning"></p>
                    </div>
                </div>

                <!-- 음력 해운 -->
                <div id="lunarHaeunSection" class="result-card glass-card hidden">
                    <h2>해운번호 (음력)</h2>
                    <div class="info-box info-box-yearly">
                        <div class="info-icon">🔮</div>
                        <div class="info-content">
                            <strong>올해의 운세 번호</strong>
                            <p>매년 운세를 나타내는 번호로 <strong>매년 변합니다</strong>. 각 번호 조합마다 점수와 해석이 다르며, 올해 당신이 겪을 상황과 주의사항을
                                알려줍니다.</p>
                        </div>
                    </div>
                    <div class="number-display">
                        <span id="haeunFirstLunar" class="big-number">-</span>
                        <span class="plus">/</span>
                        <span id="haeunSecondLunar" class="big-number">-</span>
                    </div>
                    <p id="haeunDescLunar" class="desc"></p>
                    <div class="meaning-box">
                        <p id="haeunMeaningLunar" class="meaning"></p>
                    </div>
                </div>

                <!-- 매칭 정보 (양력 기준) -->
                <div id="matchingSection" class="result-card glass-card hidden">
                    <h2>나와 잘 맞는 정보</h2>

                    <div class="matching-item">
                        <h3>행운의 숫자</h3>
                        <div id="luckyNumbers" class="pill-container"></div>
                    </div>

                    <div class="matching-item">
                        <h3>지양할 숫자</h3>
                        <div id="avoidNumbers" class="pill-container"></div>
                    </div>

                    <div class="matching-item">
                        <h3>좋은 지역 (초성)</h3>
                        <div id="consonants" class="pill-container"></div>
                    </div>

                    <div class="matching-item">
                        <h3>추천 지형</h3>
                        <p id="terrain" class="terrain-text"></p>
                    </div>

                    <div class="matching-item">
                        <h3>추천 지역 예시</h3>
                        <div id="locations" class="pill-container"></div>
                    </div>

                    <div class="matching-item">
                        <h3>잘 맞는 사주번호</h3>
                        <div id="compatible" class="pill-container"></div>
                    </div>

                    <div id="specialNotes" class="matching-item hidden">
                        <h3>특별한 특징</h3>
                        <p id="specialText" class="special-text"></p>
                    </div>

                    <div id="specialCombinationsSection" class="matching-item hidden">
                        <h3>특수 사주 조합</h3>
                        <div id="specialCombinations" class="special-combinations"></div>
                    </div>

                    <div id="zodiacSection" class="matching-item hidden">
                        <h3>띠별 타로 번호</h3>
                        <p id="zodiacInfo"></p>
                    </div>
                </div>

                <!-- 사주번호 카드 갤러리 (전체) -->
                <div id="cardGallerySection" class="result-card glass-card hidden">
                    <h2>🎴 사주 카드 전체 보기</h2>
                    <p class="card-gallery-intro">카드를 클릭하면 앞면과 뒷면을 모두 볼 수 있습니다.</p>
                    <div class="card-grid" id="cardGrid">
                        <!-- 카드들이 동적으로 추가됩니다 -->
                    </div>
                </div>

                <!-- API Key Modal -->
                <div id="apiKeyModal" class="card-modal hidden">
                    <div class="modal-overlay" id="apiKeyOverlay"></div>
                    <div class="modal-content" style="max-width: 400px;">
                        <button class="modal-close" id="apiKeyClose">✕</button>
                        <h3>🔑 Google Gemini API Key</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">
                            API Key 오류가 발생했습니다. 새로운 키를 입력해주세요.<br>
                            키는 브라우저에만 저장됩니다.
                        </p>
                        <div class="form-group">
                            <input type="password" id="apiKeyInput" placeholder="API Key를 입력하세요">
                        </div>
                        <button id="saveApiKeyBtn" class="btn-primary">저장하고 계속하기</button>
                        <p style="margin-top: 10px; font-size: 0.8rem;">
                            <a href="https://aistudio.google.com/app/apikey" target="_blank"
                                style="color: var(--accent-color);">API 키 발급받기</a>
                        </p>
                    </div>
                </div>

                <!-- Report Modal -->
                <div id="reportModal" class="card-modal hidden">
                    <div class="modal-overlay" id="reportOverlay"></div>
                    <div class="modal-content"
                        style="max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
                        <button class="modal-close" id="reportClose">✕</button>
                        <h3>📜 AI 운세 보고서</h3>
                        <div id="reportContent" style="overflow-y: auto; padding-right: 10px; line-height: 1.8;">
                            <!-- Markdown content will be injected here -->
                            <div class="loading-spinner" style="text-align: center; padding: 40px;">
                                <div class="loading"></div>
                                <p style="margin-top: 15px;">운명을 읽어내는 중입니다...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 카드 상세 모달 -->
                <div id="cardModal" class="card-modal hidden">
                    <div class="modal-overlay" id="modalOverlay"></div>
                    <div class="modal-content">
                        <button class="modal-close" id="modalClose">✕</button>
                        <h3 id="modalTitle">카드 0번</h3>
                        <div class="modal-cards">
                            <div class="modal-card-item">
                                <p class="modal-card-label">앞면</p>
                                <img id="modalFrontImg" src="" alt="앞면">
                            </div>
                            <div class="modal-card-item">
                                <p class="modal-card-label">뒷면</p>
                                <img id="modalBackImg" src="" alt="뒷면">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 액션 버튼 -->
                <div class="action-buttons">
                    <button id="copyBtn" class="btn-secondary">결과 복사</button>
                    <button id="shareBtn" class="btn-secondary">공유하기</button>
                    <button id="resetBtn" class="btn-secondary">다시하기</button>
                </div>
            </section>
        </main>

        <footer>
            <p>수비학 기반 운세 참고용 정보입니다</p>
        </footer>
    </div>

    <script type="module" src="/src/main.js"></script>
</body>

</html>